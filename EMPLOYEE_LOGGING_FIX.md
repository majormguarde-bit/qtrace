# Исправление логирования создания сотрудников

## Проблема
Записи о добавлении сотрудников не появлялись в журнале администратора, хотя логирование было реализовано.

## Причина
Основная проблема была в том, что модель `AdminPasswordLog` ожидала Django `User` в поле `admin_user`, но когда администратор тенанта (TenantUser) создавал сотрудника, `self.request.user` был TenantUser, а не Django User. Это вызывало ошибку при попытке создать запись в БД.

## Решение

### 1. Обновлена модель AdminPasswordLog
Добавлено новое поле `admin_username` для хранения имени администратора независимо от типа пользователя:

```python
admin_user = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True)
admin_username = models.CharField(max_length=150, default='unknown')
```

### 2. Обновлены представления (Views)

#### EmployeeCreateView.form_valid()
- Получает пароль ДО сохранения формы
- Если пароль не указан, использует username как пароль (как в form.save())
- Определяет тип администратора (Django User или TenantUser)
- Создает запись в AdminPasswordLog с обоими полями (admin_user и admin_username)

#### EmployeeUpdateView.form_valid()
- Аналогично EmployeeCreateView, но логирует только при изменении пароля
- Действие: 'reset' вместо 'generated'

#### log_password_generation()
- Обновлена для работы с обоими типами пользователей
- Логирует через admin_username

### 3. Обновлены представления фильтрации

#### admin_log_list()
- Фильтрует по admin_username вместо admin_user.username
- Получает список администраторов из уникальных значений admin_username

### 4. Обновлен шаблон

#### admin_log_list.html
- Отображает admin_username вместо admin_user.get_full_name
- Фильтр по администратору работает с admin_username

## Результат
Теперь логирование работает корректно:
- ✅ Создание сотрудника логируется в журнал
- ✅ Сброс пароля логируется в журнал
- ✅ Генерация пароля через кнопку логируется в журнал
- ✅ Работает для обоих типов администраторов (Django User и TenantUser)
- ✅ Все записи видны в журнале администратора с фильтрацией и поиском

## Миграция БД
Создана миграция `0002_adminpasswordlog_admin_username_and_more.py`:
- Добавлено поле `admin_username`
- Изменено поле `admin_user` на `null=True, blank=True`
- Добавлен индекс на `admin_username`

## Тестирование
1. Создайте нового сотрудника через форму
2. Перейдите в "Администрирование" → "Журнал"
3. Должна появиться запись о создании сотрудника с:
   - Именем администратора
   - Логином сотрудника
   - Действием "Сгенерирован"
   - Длиной пароля
   - IP адресом
   - Временем создания
